{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-17T00:44:04.161Z",
  "summary": "Core frontend Q&A page, STT (ne-NP), and TTS controls were added, and backend was refactored toward per-user question storage with create/list/answer APIs. However, backend text validation/rate-limiting requirements are not clearly implemented from the diff, and the diff introduces unrequested access-control/admin-token and user-profile features while also violating the constraint to not edit immutable hook files (useActor).",
  "missing_requirements": [
    {
      "id": "REQ-2",
      "requirement": "Backend validates text similarly to the current chat validation (trim whitespace-only, enforce max length, and rate-limit creation/updates).",
      "reason": "The backend createQuestion validation shown only checks content.size() == 0 and max length; it does not demonstrate trimming/whitespace-only rejection or any rate limiting. The answerQuestion implementation is truncated, so answer validation/rate limiting cannot be confirmed.",
      "evidence": [
        "backend/main.mo (createQuestion checks content.size() == 0 and > maxQuestionLength; no trimming/whitespace-only check shown; no rate-limit state shown)",
        "backend/main.mo (answerQuestion section is truncated)"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "User profile system and mandatory profile setup dialog (save/get caller profile, profile name shown in header).",
      "reason": "The BuildRequest does not request user profiles or requiring a name before using the Q&A page; it only requests private Q&A with II plus STT/TTS and branding updates.",
      "evidence": [
        "backend/main.mo (getCallerUserProfile, getUserProfile, saveCallerUserProfile; userProfiles map)",
        "frontend/src/components/ProfileSetupDialog.tsx",
        "frontend/src/hooks/useCallerUserProfile.ts",
        "frontend/src/components/AuthStatus.tsx (displays userProfile?.name)",
        "frontend/src/pages/MyQAPage.tsx (shows ProfileSetupDialog when userProfile === null)"
      ]
    },
    {
      "description": "Admin-token/secret URL parameter plumbing and access-control initialization from a URL/session token.",
      "reason": "The BuildRequest disallows third-party auth providers and requests only Internet Identity; it does not request an admin-token bootstrap mechanism via URL parameters.",
      "evidence": [
        "frontend/src/hooks/useActor.ts (getSecretParameter('caffeineAdminToken'); actor._initializeAccessControlWithSecret(adminToken))",
        "frontend/src/utils/urlParams.ts (sessionStorage persistence for parameters; comments about admin tokens)"
      ]
    },
    {
      "description": "Violation of constraint: modified an immutable hook file (useActor).",
      "reason": "Constraints explicitly state not to edit frontend immutable hook files including frontend/src/hooks/useActor.ts.",
      "evidence": [
        "frontend/src/hooks/useActor.ts (listed under MODIFIED FILES with substantial changes)"
      ]
    }
  ],
  "confidence": 0.72,
  "changed_files": [
    "backend/main.mo",
    "backend/migration.mo",
    "frontend-file-summaries.txt",
    "frontend/src/App.tsx",
    "frontend/src/components/AuthStatus.tsx",
    "frontend/src/components/MessageComposer.tsx",
    "frontend/src/components/MessageFeed.tsx",
    "frontend/src/components/ProfileSetupDialog.tsx",
    "frontend/src/components/QAComposer.tsx",
    "frontend/src/components/QAItemCard.tsx",
    "frontend/src/hooks/useActor.ts",
    "frontend/src/hooks/useAnswerQuestion.ts",
    "frontend/src/hooks/useCallerUserProfile.ts",
    "frontend/src/hooks/useChatMessages.ts",
    "frontend/src/hooks/useCreateQuestion.ts",
    "frontend/src/hooks/useQuestions.ts",
    "frontend/src/hooks/useScrollAnchor.ts",
    "frontend/src/hooks/useSendMessage.ts",
    "frontend/src/hooks/useSpeechToText.ts",
    "frontend/src/hooks/useTextToSpeech.ts",
    "frontend/src/lib/chatValidation.ts",
    "frontend/src/pages/ChatPage.tsx",
    "frontend/src/pages/MyQAPage.tsx",
    "frontend/src/utils/urlParams.ts",
    "project_state.json"
  ]
}